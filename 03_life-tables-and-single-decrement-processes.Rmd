# Life tables and single decrement processes

```{r setup, echo=FALSE, message=FALSE, warning=FALSE}
library(dplyr)
library(fuzzyjoin)
```

:::{.rmdimportant}
**KEY CONCEPT**

A **life table** is one of the most important demographic tools for summarizing the mortality experience of a cohort.
:::

### Cohort life tables with lifeline data {.unnumbered}

Since a life table summarizes the experience of a cohort, let's start by building a life table from the lifelines of a small hypothetical cohort based actual people born January 1, 1800^[This section uses the example from PHG pgs. 39-41].

```{r cohort_lt_setup, echo=FALSE, message=FALSE, warning=FALSE}
age_groups <- tibble::tibble(
  x = c(0, 1, 5, 10, 20, 30, 40, 50, 60, 70, 80),
  n = c(1, 4, 5, 10, 10, 10, 10, 10, 10, 10, NA),
  xpn = x + n
) %>%
  dplyr::mutate(group_id = dplyr::row_number())
cohort_data <- tibble::tibble(
  exit_age = c(
    71.55,
    1.22,
    62.91,
    59.60,
    0.07,
    22.12,
    71.14,
    16.41,
    64.05,
    76.79
  )
) %>%
  dplyr::mutate(id = dplyr::row_number())
cohort_lt <- age_groups %>%
  fuzzyjoin::fuzzy_left_join(
    cohort_data,
    by = c("x" = "exit_age", "xpn" = "exit_age"), 
    match_fun = list(`<=`, `>`)
  ) %>%
  dplyr::mutate(indiv_a = dplyr::case_when(
    (exit_age < x) ~ 0,
    (x <= exit_age) & (exit_age < xpn) ~ exit_age - x,
    exit_age >= xpn ~ n
  )) %>%
  dplyr::group_by(x, n,xpn) %>%
  dplyr::summarize(
    d = sum(!is.na(exit_age)),
    a = sum(indiv_a)
  ) %>%
  dplyr::ungroup() %>%
  dplyr::mutate(
    l = nrow(cohort_data) - cumsum(dplyr::lag(d, default = 0)),
    q = d / l,
    p = 1 - q,
    L = (l - d) * n + ifelse(is.na(a), 0, a),
    m = d / L,
    T = rev(L) %>% dplyr::coalesce(0) %>% cumsum() %>% rev(),
    e0 = T / l
  ) %>%
  dplyr::select(x, n, l, d, q, p, L, T, e0, m, a)
```

A lifelines plot like we drew in

## Period life tables

## Strategies for making age-specific rate $\rightarrow$ probability (${}_{n}m_x$ $\rightarrow$ ${}_{n}q_x$) conversion

### Direction observation (duh)

:::{.rmdtip}
**DEMOGRAPHY & DATA SCIENCE**

#### Direct observation is almost almost possible in the corporate world

#### But not always...
:::

### Graduation of the age-specific mortality rate (${}_{n}m_x$) function

### Borrowing average person-years lived (${}_{n}a_x$) values from another population

### Using rules of thumb

## The very young ages

## The open-ended age interval

## Review of the steps for period life table construction

## Interpreting the life table

## The life table conceived as a stationary population

## Mortality as a continuous process

## Life table construction revisited

## Decomposing a difference in life expectancies

## Adaptation of the life table for studying other single decrement processes

:::{.rmdtip}
**DEMOGRAPHY & DATA SCIENCE**

### Beware of the all-cause attrition hegemon
:::
